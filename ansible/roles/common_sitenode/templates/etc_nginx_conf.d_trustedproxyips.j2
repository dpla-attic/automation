
## TODO:  Is this necessary?  The site proxy configuration also uses
#         set_real_ip_from.
#         See roles/site_proxy/templates/etc_nginx_sites_available_site-proxy.j2

# identify and use ip address from trusted proxy connections
real_ip_header X-Forwarded-For;
{% if all_in_one_hosts | default(false) %}
set_real_ip_from {{ hostvars[inventory_hostname][internal_network_interface].ipv4.address }}
{% else %}
{% for h in groups['site_proxies'] %}
set_real_ip_from {{ hostvars[h][internal_network_interface]['ipv4']['address'] }};
{% endfor %}
{% endif %}
